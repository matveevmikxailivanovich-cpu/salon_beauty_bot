# ============================================
# requirements.txt - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
# ============================================
python-telegram-bot==20.7
flask==3.0.0

# ============================================
# render.yaml - –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –î–õ–Ø RENDER
# ============================================
services:
  - type: worker  # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: Background Worker
    name: salon-beauty-bot
    env: python
    region: oregon  # –í—ã–±–µ—Ä–∏—Ç–µ –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–≥–∏–æ–Ω
    plan: free
    buildCommand: |
      echo "üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
      pip install --no-cache-dir -r requirements.txt
      echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    startCommand: |
      echo "üöÄ –ó–∞–ø—É—Å–∫ Telegram-–±–æ—Ç–∞..."
      python bot_render_v2.py
    envVars:
      - key: BOT_TOKEN
        value: 8215198856:AAFaeNBZnrKig1tU0VR74DoCTHdrXsRKV1U
      - key: DATABASE_PATH
        value: /tmp/salon_bot.db
      - key: USE_WEBHOOK
        value: false
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: PYTHONUNBUFFERED
        value: "1"
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
    autoDeploy: true
    
    # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ä—Ç–æ–≤ –¥–ª—è Background Worker
    healthCheckPath: ""

# ============================================
# Procfile - –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# ============================================
worker: python bot_render_v2.py

# ============================================
# runtime.txt - –í–ï–†–°–ò–Ø PYTHON
# ============================================
python-3.11.0

# ============================================
# .gitignore - –ß–¢–û –ù–ï –ó–ê–ì–†–£–ñ–ê–¢–¨ –ù–ê GITHUB
# ============================================
# –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
*.db
*.log
.env
__pycache__/
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.venv/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# ============================================
# start.sh - –°–ö–†–ò–ü–¢ –ó–ê–ü–£–°–ö–ê (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# ============================================
#!/bin/bash
set -e

echo "üöÄ –ó–∞–ø—É—Å–∫ Telegram-–±–æ—Ç–∞ —Å–∞–ª–æ–Ω–∞ –∫—Ä–∞—Å–æ—Ç—ã"
echo "üìÖ –í—Ä–µ–º—è: $(date)"
echo "üåç –û–∫—Ä—É–∂–µ–Ω–∏–µ: $RENDER_SERVICE_NAME"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ -z "$BOT_TOKEN" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    exit 1
fi

echo "‚úÖ BOT_TOKEN: ${BOT_TOKEN:0:15}..."
echo "üìÇ DATABASE_PATH: ${DATABASE_PATH:-/tmp/salon_bot.db}"
echo "üêç Python: $(python --version)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ python-telegram-bot..."
python -c "import telegram; print(f'‚úÖ telegram-bot –≤–µ—Ä—Å–∏—è: {telegram.__version__}')" || {
    echo "‚ùå –û—à–∏–±–∫–∞: python-telegram-bot –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    exit 1
}

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p /tmp/logs

echo "ü§ñ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
exec python bot_render_v2.py

# ============================================
# health_check.py - –ü–†–û–í–ï–†–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø –ë–û–¢–ê
# ============================================
#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞
–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
"""

import sqlite3
import os
import sys
from datetime import datetime

def check_bot_health():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–æ—Ç–∞"""
    health_status = {
        'database': False,
        'bot_token': False,
        'timestamp': datetime.now().isoformat()
    }
    
    try:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
        bot_token = os.getenv('BOT_TOKEN')
        if bot_token and len(bot_token) > 20:
            health_status['bot_token'] = True
            print("‚úÖ BOT_TOKEN: OK")
        else:
            print("‚ùå BOT_TOKEN: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
        db_path = os.getenv('DATABASE_PATH', '/tmp/salon_bot.db')
        if os.path.exists(db_path):
            conn = sqlite3.connect(db_path)
            cursor = conn.cursor()
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
            cursor.execute("SELECT name FROM sqlite_master WHERE type='table'")
            tables = cursor.fetchall()
            expected_tables = ['users', 'appointments']
            
            existing_tables = [table[0] for table in tables]
            if all(table in existing_tables for table in expected_tables):
                health_status['database'] = True
                print("‚úÖ DATABASE: OK")
                
                # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                cursor.execute("SELECT COUNT(*) FROM users")
                users_count = cursor.fetchone()[0]
                cursor.execute("SELECT COUNT(*) FROM appointments WHERE status='active'")
                appointments_count = cursor.fetchone()[0]
                
                print(f"üìä –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {users_count}")
                print(f"üìÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: {appointments_count}")
            else:
                print("‚ùå DATABASE: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã")
            
            conn.close()
        else:
            print("‚ùå DATABASE: –§–∞–π–ª –ë–î –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: {e}")
    
    # –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å
    all_ok = all(health_status[key] for key in ['database', 'bot_token'])
    print(f"\n{'‚úÖ –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å: OK' if all_ok else '‚ùå –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å: –û–®–ò–ë–ö–ê'}")
    
    return all_ok

if __name__ == '__main__':
    print("üîç –ü–†–û–í–ï–†–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø –ë–û–¢–ê")
    print("=" * 40)
    
    success = check_bot_health()
    sys.exit(0 if success else 1)

# ============================================
# deploy_checklist.md - –ß–ï–ö–õ–ò–°–¢ –î–ï–ü–õ–û–Ø
# ============================================

# üöÄ –ß–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è –Ω–∞ Render

## –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
- [ ] –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –í–°–ï –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ –±–æ—Ç–∞ (Ctrl+C)
- [ ] –ó–∞–∫—Ä—ã—Ç—ã –≤—Å–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã —Å –∑–∞–ø—É—â–µ–Ω–Ω—ã–º –±–æ—Ç–æ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–µ

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤
- [ ] –°–æ–∑–¥–∞–Ω `bot_render_v2.py` (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω `requirements.txt` (–≤–µ—Ä—Å–∏—è 20.7)
- [ ] –°–æ–∑–¥–∞–Ω `render.yaml` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- [ ] –î–æ–±–∞–≤–ª–µ–Ω `.gitignore` (–∏—Å–∫–ª—é—á–∞–µ—Ç .env, *.db)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

### 3. GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [ ] –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã: `git add . && git commit -m "Fix for Render" && git push`
- [ ] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Render
- [ ] –û—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞: `main`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Render

### 4. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
- [ ] –ó–∞–π—Ç–∏ –Ω–∞ [render.com](https://render.com)
- [ ] –ù–∞–∂–∞—Ç—å "New +" ‚Üí **"Background Worker"** (–ù–ï Web Service!)
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [ ] –í—ã–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ç–∫—É (main)

### 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
```
Name: salon-beauty-bot
Environment: Python 3
Build Command: pip install -r requirements.txt
Start Command: python bot_render_v2.py
Plan: Free
Auto-Deploy: Yes
```

### 6. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] `BOT_TOKEN` = `8215198856:AAFaeNBZnrKig1tU0VR74DoCTHdrXsRKV1U`
- [ ] `DATABASE_PATH` = `/tmp/salon_bot.db`
- [ ] `USE_WEBHOOK` = `false`
- [ ] `PYTHON_VERSION` = `3.11.0`
- [ ] `PYTHONUNBUFFERED` = `1`

## –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
- [ ] `üöÄ –°–¢–ê–†–¢ TELEGRAM-–ë–û–¢–ê –ù–ê RENDER...`
- [ ] `‚úÖ python-telegram-bot –≤–µ—Ä—Å–∏—è: 20.7`
- [ ] `üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram-–±–æ—Ç–∞ –¥–ª—è Render...`
- [ ] `üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞: /tmp/salon_bot.db`
- [ ] `ü§ñ –ë–û–¢ –ó–ê–ü–£–©–ï–ù –ù–ê RENDER!`
- [ ] `üîÑ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç...`

### 8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/start`
- [ ] –†–∞–±–æ—Ç–∞–µ—Ç –∑–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—É
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ª—É–≥–∏ –∏ —Ü–µ–Ω—ã
- [ ] –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—Å—Ç–µ—Ä–∞—Ö
- [ ] –§—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –∞–∫—Ü–∏–∏
- [ ] –†–∞–±–æ—Ç–∞–µ—Ç "–ú–æ–∏ –∑–∞–ø–∏—Å–∏"

### 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- [ ] –°–µ—Ä–≤–∏—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "Live"
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö –∑–∞ 10 –º–∏–Ω—É—Ç
- [ ] CPU Usage < 50%
- [ ] Memory Usage < 100MB
- [ ] –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –¥—Ä—É–≥–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ "Conflict: terminated by other getUpdates request"
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –¥—Ä—É–≥–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –±–æ—Ç–∞
2. –í Render: Manual Deploy ‚Üí Deploy Latest Commit
3. –î–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

### –ï—Å–ª–∏ "No open ports detected"
1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ–∑–¥–∞–Ω **Background Worker**, –Ω–µ Web Service
2. Background Worker –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ—Ä—Ç–æ–≤ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `requirements.txt`: `python-telegram-bot==20.7`
2. –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é 21.0
3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å–µ—Ä–≤–∏—Å

### –ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ BOT_TOKEN –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–æ—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ Telegram

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ï–∂–µ–¥–Ω–µ–≤–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞ –≤ Render Dashboard
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –±–æ—Ç–∞

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- [ ] –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

**üéâ –£—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞: "Live"
- –õ–æ–≥–∏ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
- –ó–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –¥—Ä—É–≥–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏
